-- create database PROYECTO_CAFE_V2;
use PROYECTO_CAFE_V2;
CREATE TABLE TBL_OPERARIO (
    CEDULA_OPERARIO VARCHAR(20) NOT NULL,
    NOMBRE_OPERARIO VARCHAR(30) NOT NULL,
    TELEFONO_OPERARIO VARCHAR(30) NOT NULL,
    DIRECCION_OPERARIO VARCHAR(30) NOT NULL,
    EMAIL_OPERARIO VARCHAR(30) NOT NULL,
    FOTO_OPERARIO TEXT,
    PRIMARY KEY (CEDULA_OPERARIO),
    CONSTRAINT UNQ_CEDULA_OPERARIO UNIQUE (CEDULA_OPERARIO)
);

INSERT INTO TBL_OPERARIO(CEDULA_OPERARIO,NOMBRE_OPERARIO,TELEFONO_OPERARIO,DIRECCION_OPERARIO,EMAIL_OPERARIO,FOTO_OPERARIO)
VALUES
('1065442042','GIOVANA BERNATE','3183432668','VEREDA LA MARIA','giovanabernate@gmail.com','OPERARIO1.jpg'),
('9876543215','ANA GOMEZ','3204568475','BARRIO LA INMACULADA','anagomez@gmail.com','OPERARIO2.jpg'),
('4545544521','ISABEL LOPEZ','3145358465','VEREDA BETANIA','isabellopez@gmail.com','OPERARIO3.jpg');

CREATE TABLE TBL_PROVEEDOR (
    CEDULA_PROVEEDOR VARCHAR(20) NOT NULL,
    NOMBRE_PROVEEDOR VARCHAR(30) NOT NULL,
    TELEFONO_PROVEEDOR VARCHAR(30) NOT NULL,
    DIRECCION_PROVEEDOR VARCHAR(30) NOT NULL,
    EMAIL_PROVEEDOR VARCHAR(30) NOT NULL,
    FOTO_PROVEEDOR TEXT,
    PRIMARY KEY (CEDULA_PROVEEDOR),
    CONSTRAINT UNQ_CEDULA_PROVEEDOR UNIQUE (CEDULA_PROVEEDOR)
);
INSERT INTO TBL_PROVEEDOR(CEDULA_PROVEEDOR, NOMBRE_PROVEEDOR, TELEFONO_PROVEEDOR, DIRECCION_PROVEEDOR, EMAIL_PROVEEDOR, FOTO_PROVEEDOR)
VALUES
  ('123456789', 'PROVEEDOR 1', '3158429567', 'VEREDA CAMILO TORRES', 'proveedor1@example.com', 'PROVEEDOR1.jpg'),
  ('474464448', 'PROVEEDOR 2', '3124577861', 'VEREDA LA INDEPENDENCIA', 'proveedor2@example.com', 'PROVEEDOR2.jpg'),
  ('787841112', 'PROVEEDOR 3', '3134145284', 'VEREDA SAN PEDRO', 'proveedor3@example.com', 'PROVEEDOR3.jpg');


CREATE TABLE TBL_TIPO_PROCESO(
ID_TIPO_PROCESO INT AUTO_INCREMENT,
NOMBRE VARCHAR(30) NOT NULL,
 PRIMARY KEY (ID_TIPO_PROCESO)
);

INSERT INTO TBL_TIPO_PROCESO(NOMBRE)
VALUES 
 ('PROCESO 1'),
 ('PROCESO 2'),
 ('PROCESO 3');
 
CREATE TABLE TBL_VARIEDAD_CAFE(
ID_VARIEDAD_CAFE INT AUTO_INCREMENT,
NOMBRE VARCHAR(30) NOT NULL,
 PRIMARY KEY (ID_VARIEDAD_CAFE)
);

INSERT INTO TBL_VARIEDAD_CAFE(NOMBRE)
VALUES 
 ('VARIEDAD 1'),
 ('VARIEDAD 2'),
 ('VARIEDAD 3');

CREATE TABLE TBL_MAQUINA(
ID_MAQUINA VARCHAR (5) NOT NULL,
NOMBRE VARCHAR(20),
 PRIMARY KEY (ID_MAQUINA )
);

INSERT INTO TBL_MAQUINA(ID_MAQUINA,NOMBRE)
VALUES
  ('M01', 'MAQUINA 1'),
  ('M02', 'MAQUINA 2'),
  ('M03', 'MAQUINA 3');


CREATE TABLE TBL_LOTE_CAFE (
    ID_LOTE_CAFE INT AUTO_INCREMENT,
    PESO VARCHAR(30) NOT NULL,
    CEDULA_PROVEEDOR VARCHAR(20),
    ID_TIPO_PROCESO INTEGER,
    ID_VARIEDAD_CAFE INTEGER,
    PRIMARY KEY (ID_LOTE_CAFE),
    CONSTRAINT FK_CEDULA_PROVEEDOR FOREIGN KEY (CEDULA_PROVEEDOR) REFERENCES TBL_PROVEEDOR (CEDULA_PROVEEDOR) ON DELETE CASCADE ON UPDATE CASCADE,
    CONSTRAINT FK_ID_TIPO_PROCESO FOREIGN KEY (ID_TIPO_PROCESO) REFERENCES TBL_TIPO_PROCESO (ID_TIPO_PROCESO) ON DELETE CASCADE ON UPDATE CASCADE,
    CONSTRAINT FK_ID_VARIEDAD_CAFE FOREIGN KEY (ID_VARIEDAD_CAFE) REFERENCES TBL_VARIEDAD_CAFE (ID_VARIEDAD_CAFE) ON DELETE CASCADE ON UPDATE CASCADE
);

INSERT INTO TBL_LOTE_CAFE (PESO,CEDULA_PROVEEDOR,ID_TIPO_PROCESO,ID_VARIEDAD_CAFE)
VALUES
  ('10 kg','123456789', 1, 1),
  ('8 kg','474464448', 2, 2),
  ('12 kg','787841112', 3, 3);

CREATE TABLE TBL_SEGUIMIENTO (
    ID_SEGUIMIENTO INT AUTO_INCREMENT,
    FECHA_HORA DATETIME,
    ID_LOTE_CAFE INTEGER,
    CEDULA_OPERARIO VARCHAR(20),
    PRIMARY KEY (ID_SEGUIMIENTO),
    CONSTRAINT FK_ID_LOTE_CAFE FOREIGN KEY (ID_LOTE_CAFE) REFERENCES TBL_LOTE_CAFE (ID_LOTE_CAFE) ON DELETE CASCADE ON UPDATE CASCADE,
    CONSTRAINT FK_CEDULA_OPERARIO FOREIGN KEY (CEDULA_OPERARIO) REFERENCES TBL_OPERARIO (CEDULA_OPERARIO) ON DELETE CASCADE ON UPDATE CASCADE
);

INSERT INTO TBL_SEGUIMIENTO (FECHA_HORA,ID_LOTE_CAFE,CEDULA_OPERARIO)
VALUES
  ('2023-01-01 08:00:00', 1, '1065442042'),
  ('2023-01-02 10:30:00', 2, '9876543215'),
  ('2023-01-03 12:45:00', 3, '4545544521');

CREATE TABLE TBL_ESTADOS_MAQUINA (
    ID_ESTADOS_MAQUINA INT AUTO_INCREMENT,
    ESTADO VARCHAR(30) NOT NULL,
    ROTOR VARCHAR(32) UNIQUE NOT NULL,
    TEMPERATURA VARCHAR(30) NOT NULL,
    TEMPERATURA_S1 VARCHAR(30) NOT NULL,
    TEMPERATURA_S2 VARCHAR(30) NOT NULL,
    TEMPERATURA_PROMEDIO VARCHAR(30) NOT NULL,
    FECHA_HORA DATETIME NOT NULL,
    ID_MAQUINA VARCHAR(5),
    PRIMARY KEY (ID_ESTADOS_MAQUINA),
    CONSTRAINT FK_ID_MAQUINA FOREIGN KEY (ID_MAQUINA) REFERENCES TBL_MAQUINA (ID_MAQUINA) ON DELETE CASCADE ON UPDATE CASCADE
);
INSERT INTO TBL_ESTADOS_MAQUINA (ESTADO, ROTOR, TEMPERATURA, TEMPERATURA_S1, TEMPERATURA_S2, TEMPERATURA_PROMEDIO, FECHA_HORA, ID_MAQUINA)
VALUES
  ('En operación', 'RotorA', '30°C', '25°C', '28°C', '27.7°C', '2023-01-01 08:00:00', 'M01'),
  ('Fuera de servicio', 'RotorB', '35°C', '30°C', '32°C', '32.3°C', '2023-01-02 10:30:00', 'M02'),
  ('En mantenimiento', 'RotorC', '28°C', '26°C', '27°C', '27.0°C', '2023-01-03 12:45:00', 'M03');


CREATE TABLE TBL_RELACION_LOTE_ESTADO (
    ID_LOTE_CAFE INTEGER,
    ID_ESTADOS_MAQUINA INTEGER,
    PRIMARY KEY (ID_LOTE_CAFE, ID_ESTADOS_MAQUINA),
    CONSTRAINT FK_LOTE_CAFE_RELACION FOREIGN KEY (ID_LOTE_CAFE) REFERENCES TBL_LOTE_CAFE (ID_LOTE_CAFE) ON DELETE CASCADE ON UPDATE CASCADE,
    CONSTRAINT FK_ESTADOS_MAQUINA_RELACION FOREIGN KEY (ID_ESTADOS_MAQUINA) REFERENCES TBL_ESTADOS_MAQUINA (ID_ESTADOS_MAQUINA) ON DELETE CASCADE ON UPDATE CASCADE
);

INSERT INTO TBL_RELACION_LOTE_ESTADO(ID_LOTE_CAFE,ID_ESTADOS_MAQUINA)
VALUES
  (1, 1),
  (2, 2),
  (3, 3);
